import 'dart:convert';

import 'package:bloc/bloc.dart';
import 'package:equatable/equatable.dart';
import 'package:vario/domain/models/investment_item/backend/get_stock_news_response.dart';
import 'package:vario/domain/models/investment_item/backend/stock_news_model.dart';

import '../../../../../domain/models/investment_item/analysis_article.dart';


part 'asset_news_state.dart';

class AssetNewsCubit extends Cubit<AssetNewsState> {
  final String assetId;
  final String assetTitle;

  AssetNewsCubit(this.assetId, this.assetTitle) : super(AssetNewsInitial());

  List<AnalysisArticle> _parseArticles(List<StockNewsModel> data) {
    return data.map((e) {
      return AnalysisArticle(
          date: DateTime.parse(e.publishedDate),
          pictureUrl: e.image,
          source: e.site,
          url: e.url,
          title: e.title);
    }).toList();
  }

  Future<GetStockNewsResponse> getDummyNews() async {
    await Future.delayed(Duration(seconds: 1));
    return GetStockNewsResponse.fromJson(json.decode('''{"stockNews":[{"symbol":"IRM","publishedDate":"2021-11-10 13:45:10","title":"What Makes Iron Mountain (IRM) a New Buy Stock","image":"https://cdn.snapi.dev/images/v1/a/n/software18-1101037.jpg","site":"Zacks Investment Research","text":"Iron Mountain (IRM) might move higher on growing optimism about its earnings prospects, which is reflected by its upgrade to a Zacks Rank #2 (Buy).","url":"https://www.zacks.com/stock/news/1826740/what-makes-iron-mountain-irm-a-new-buy-stock"},{"symbol":"IRM","publishedDate":"2021-11-09 15:22:00","title":"Dividend Income Summary: Bert's October 2021 Report","image":"https://cdn.snapi.dev/images/v1/s/t/stocksnetapp1-1098292.jpg","site":"Seeking Alpha","text":"Dividend Income Summary: Bert's October 2021 Report","url":"https://seekingalpha.com/article/4467503-dividend-income-summary-berts-october-2021-report"},{"symbol":"IRM","publishedDate":"2021-11-08 08:35:00","title":"Buffett Says Make Money While You Sleep, 3 Dividends For A Retirement Dream","image":"https://cdn.snapi.dev/images/v1/m/x/reit15-1094235.jpg","site":"Seeking Alpha","text":"Warren Buffett loves collecting dividends, don't let anyone tell you otherwise.","url":"https://seekingalpha.com/article/4465989-buffett-says-make-money-while-you-sleep-3-dividends-for-a-retirement-dream"},{"symbol":"IRM","publishedDate":"2021-11-08 07:00:00","title":"Become An NFT Landlord And Sleep Well At Night","image":"https://cdn.snapi.dev/images/v1/4/c/reit3-1093789.jpg","site":"Seeking Alpha","text":"Become An NFT Landlord And Sleep Well At Night","url":"https://seekingalpha.com/article/4466825-become-an-nft-landlord-and-sleep-well-at-night"},{"symbol":"IRM","publishedDate":"2021-11-07 07:35:45","title":"3 Big-Dividend REITs: Dumpster Dives Worth Considering","image":"https://cdn.snapi.dev/images/v1/3/r/software13-1093298.jpg","site":"Seeking Alpha","text":"One man's trash is another man's treasure. We review 3 big-dividend REITs that sold off hard.","url":"https://seekingalpha.com/article/4466689-3-big-dividend-reits-dumpster-dives-worth-considering"},{"symbol":"IRM","publishedDate":"2021-11-06 09:00:00","title":"REITs At All-Time Highs - Time To Sell?","image":"https://cdn.snapi.dev/images/v1/0/s/data-internet6-1092951.jpg","site":"Seeking Alpha","text":"Many REITs are at all-time highs, despite interest rate drama from the Fed. We've sold several of our REITs because they no longer offer a compelling risk-reward profile.","url":"https://seekingalpha.com/article/4466345-reits-at-all-time-highs-time-to-sell"},{"symbol":"IRM","publishedDate":"2021-11-04 12:43:56","title":"Iron Mountain Reports Q3 Earnings In-Line With Consensus, Confirms FY21 Outlook","image":"https://cdn.snapi.dev/images/v1/n/l/irm2-1088991.jpg","site":"Benzinga","text":"Iron Mountain Inc (NYSE: IRM) reported third-quarter FY21 revenue growth of 9% year-on-year to \$1.13 billion, at par with the consensus. Storage Rental Revenue grew 3% Y/Y to \$719 million.","url":"https://www.benzinga.com/news/earnings/21/11/23884970/iron-mountain-reports-q3-earnings-in-line-with-consensus-confirms-fy21-outlook"},{"symbol":"IRM","publishedDate":"2021-11-04 10:58:09","title":"Iron Mountain Incorporated (IRM) CEO Bill Meaney on Q3 2021 Results - Earnings Call Transcript","image":"https://cdn.snapi.dev/images/v1/s/j/transcript16-1088675.jpg","site":"Seeking Alpha","text":"Iron Mountain Incorporated (IRM) CEO Bill Meaney on Q3 2021 Results - Earnings Call Transcript","url":"https://seekingalpha.com/article/4465400-iron-mountain-incorporated-irm-ceo-bill-meaney-on-q3-2021-results-earnings-call-transcript"},{"symbol":"IRM","publishedDate":"2021-11-04 08:25:08","title":"Iron Mountain (IRM) Tops Q3 FFO Estimates","image":"https://cdn.snapi.dev/images/v1/5/d/software3-1087994.jpg","site":"Zacks Investment Research","text":"Iron Mountain (IRM) delivered FFO and revenue surprises of 2.86% and -0.13%, respectively, for the quarter ended September 2021. Do the numbers hold clues to what lies ahead for the stock?","url":"https://www.zacks.com/stock/news/1823321/iron-mountain-irm-tops-q3-ffo-estimates"},{"symbol":"IRM","publishedDate":"2021-11-04 08:25:00","title":"Sell Alert: 2 REITs Getting Risky","image":"https://cdn.snapi.dev/images/v1/g/5/software4-1088004.jpg","site":"Seeking Alpha","text":"Sell Alert: 2 REITs Getting Risky","url":"https://seekingalpha.com/article/4464262-sell-alert-2-reits-getting-risky"},{"symbol":"IRM","publishedDate":"2021-11-03 14:50:00","title":"Dividend Income Summary: Lanny's October 2021 Summary","image":"https://cdn.snapi.dev/images/v1/t/o/top-stocks-to-buy-this-month-amid-optimistic-markets-755996-812736-1085832.jpg","site":"Seeking Alpha","text":"In October, we (my wife and I) received a total of \$966.97 of dividend income.","url":"https://seekingalpha.com/article/4464985-dividend-income-summary-lannys-october-2021-summary"},{"symbol":"IRM","publishedDate":"2021-11-02 09:57:46","title":"What's in the Offing for Iron Mountain's (IRM) Q3 Earnings?","image":"https://cdn.snapi.dev/images/v1/1/f/software41-1081867.jpg","site":"Zacks Investment Research","text":"Iron Mountain's (IRM) gains from strength in core storage and record management businesses as well as high demand for data centers are likely to have aided Q3 earnings.","url":"https://www.zacks.com/stock/news/1821631/what-s-in-the-offing-for-iron-mountain-s-irm-q3-earnings"},{"symbol":"IRM","publishedDate":"2021-10-27 11:55:10","title":"Iron Mountain: A Strong Performing REIT That Continues Growing","image":"https://cdn.snapi.dev/images/v1/o/m/software29-1070700.jpg","site":"Seeking Alpha","text":"Iron Mountain has been a core REIT holding for me for a number of years now, and I will continue to hold for the Long Term.","url":"https://seekingalpha.com/article/4462413-iron-mountain-a-strong-performing-reit"},{"symbol":"IRM","publishedDate":"2021-10-27 10:52:44","title":"The Shine And The Shadow For Iron Mountain Investors","image":"https://cdn.snapi.dev/images/v1/2/9/29od22-1070547.","site":"Seeking Alpha","text":"The position and model of the business have resulted in 95% customer retention rate year after year. Earnings are expected to remain strong.","url":"https://seekingalpha.com/article/4462389-shine-shadow-for-iron-mountain-investors"},{"symbol":"IRM","publishedDate":"2021-10-19 10:35:00","title":"Yes, You Can Retire On Dividends: 2 Great Dividends To Load Up On","image":"https://cdn.snapi.dev/images/v1/q/7/asset-management24-35-1055535.jpg","site":"Seeking Alpha","text":"Retirement planning is in turmoil for many would be retirees. Retirement has recurring expenses, meet them head on with recurring income.","url":"https://seekingalpha.com/article/4460288-yes-you-can-retire-on-dividends-2-great-dividends-to-load-up-on"},{"symbol":"IRM","publishedDate":"2021-10-16 07:00:00","title":"Trick Or Treat? The Data Center REITs","image":"https://cdn.snapi.dev/images/v1/b/e/reit26-1052232.jpg","site":"Seeking Alpha","text":"Companies experiencing strong secular growth tailwinds should experience fundamental growth, regardless of the strength of the macro economy. These are the investment types that often outperform during uncertain times while the rest of the market lacks clear growth.","url":"https://seekingalpha.com/article/4460077-trick-treat-data-center-reits"},{"symbol":"IRM","publishedDate":"2021-10-12 10:11:06","title":"Here's Why You Should Retain Iron Mountain (IRM) Stock Now","image":"https://cdn.snapi.dev/images/v1/y/a/software12-1044992.jpg","site":"Zacks Investment Research","text":"Iron Mountain (IRM) is likely to benefit from its focus on data-center portfolio expansion, though a low service activity level is concerning.","url":"https://www.zacks.com/stock/news/1809598/here-s-why-you-should-retain-iron-mountain-irm-stock-now"},{"symbol":"IRM","publishedDate":"2021-09-30 08:25:00","title":"Sell Alert: 2 REITs Getting Risky","image":"https://cdn.snapi.dev/images/v1/e/e/software48-1029105.jpg","site":"Seeking Alpha","text":"Sell Alert: 2 REITs Getting Risky","url":"https://seekingalpha.com/article/4457786-sell-alert-2-reits-getting-risky"},{"symbol":"IRM","publishedDate":"2021-09-24 07:14:23","title":"The 6 Highest Yielding S&P 500 Dividend Stocks Are Outstanding Buys Now","image":"https://cdn.snapi.dev/images/v1/o/2/software46-1021328.jpg","site":"24/7 Wall Street","text":"Investors love dividend stocks because they not only provide dependable income but also give investors a great opportunity for solid total return.","url":"https://247wallst.com/investing/2021/09/24/the-6-highest-yielding-sp-500-dividend-stocks-are-outstanding-buys-now/"},{"symbol":"IRM","publishedDate":"2021-09-23 12:19:45","title":"7 High-Yield Dividend Stocks That Will Please Any Income Lover","image":"https://cdn.snapi.dev/images/v1/k/9/reit10-1020326.jpg","site":"InvestorPlace","text":"These seven dividend stocks, all yielding 5% or more, make great additions to any income investor's portfolio. The post 7 High-Yield Dividend Stocks That Will Please Any Income Lover appeared first on InvestorPlace.","url":"https://investorplace.com/2021/09/7-high-yield-dividend-stocks-please-any-income-lover/"}]}'''));
  }


  Future<void> fetchNews({int limit}) async {
    emit(AssetNewsLoading());
    try {
      final newsDataResponse = await getDummyNews();
          // await StocksApi().getStockNews(assetId, limit: limit);
      final articles = _parseArticles(newsDataResponse.stockNews);
      emit(AssetNewsLoaded(articles));
    } catch (e, stacktrace) {
      // emit(AssetNewsError(GlobalErrorData(e, stackTrace: stacktrace)));
      rethrow;
    }
  }
}
